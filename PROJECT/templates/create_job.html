{% extends "base.html" %}
{% block title %}Post New Job - JobMatch Pro{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-plus-circle"></i> Post New Job
                    </h3>
                </div>
                
                <form method="POST" action="{{ url_for('create_job') }}">
                    <div class="card-body">
                        <div class="row">
                            <!-- Basic Job Information -->
                            <div class="col-md-8">
                                <div class="form-group">
                                    <label for="title">Job Title *</label>
                                    <input type="text" class="form-control" id="title" name="title" required>
                                </div>
                                
                                <div class="form-group">
                                    <label for="description">Job Description *</label>
                                    <textarea class="form-control" id="description" name="description" rows="6" required></textarea>
                                </div>
                                
                                <div class="form-group">
                                    <label for="requirements">Requirements</label>
                                    <textarea class="form-control" id="requirements" name="requirements" rows="4"></textarea>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="location">Location</label>
                                            <input type="text" class="form-control" id="location" name="location">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="job_type">Job Type *</label>
                                            <select class="form-control" id="job_type" name="job_type" required>
                                                <option value="">Select Job Type</option>
                                                <option value="Full-time">Full-time</option>
                                                <option value="Part-time">Part-time</option>
                                                <option value="Contract">Contract</option>
                                                <option value="Internship">Internship</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label for="experience_required">Experience Required (Years)</label>
                                            <input type="number" class="form-control" id="experience_required" name="experience_required" min="0" value="0">
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label for="salary_min">Minimum Salary</label>
                                            <input type="number" class="form-control" id="salary_min" name="salary_min" min="0">
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label for="salary_max">Maximum Salary</label>
                                            <input type="number" class="form-control" id="salary_max" name="salary_max" min="0">
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="application_deadline">Application Deadline</label>
                                    <input type="date" class="form-control" id="application_deadline" name="application_deadline">
                                </div>
                            </div>
                            
                            <!-- Sidebar for Additional Options -->
                            <div class="col-md-4">
                                <!-- NEW: Exam Creation Section -->
                                <div class="card mb-3">
                                    <div class="card-header bg-info text-white">
                                        <h5 class="mb-0">
                                            <i class="fas fa-clipboard-check"></i> Create Exam (Optional)
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="form-check mb-3">
                                            <input class="form-check-input" type="checkbox" id="create_exam" name="create_exam" onchange="toggleExamOptions()">
                                            <label class="form-check-label" for="create_exam">
                                                <strong>Create technical exam for this job</strong>
                                            </label>
                                        </div>
                                        
                                        <div id="exam_options" style="display: none;">
                                            <div class="form-group">
                                                <label for="exam_title">Exam Title</label>
                                                <input type="text" class="form-control" id="exam_title" name="exam_title" placeholder="Auto-generated from job title">
                                            </div>
                                            
                                            <div class="form-group">
                                                <label for="exam_description">Exam Description</label>
                                                <textarea class="form-control" id="exam_description" name="exam_description" rows="2"></textarea>
                                            </div>
                                            
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="form-group">
                                                        <label for="exam_duration">Duration (minutes)</label>
                                                        <input type="number" class="form-control" id="exam_duration" name="exam_duration" value="60" min="15" max="180">
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="form-group">
                                                        <label for="exam_passing_score">Passing Score (%)</label>
                                                        <input type="number" class="form-control" id="exam_passing_score" name="exam_passing_score" value="60" min="0" max="100">
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <small class="text-muted">
                                                <i class="fas fa-info-circle"></i> 
                                                You can add questions after creating the job.
                                            </small>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Skills Section -->
                                <div class="card">
                                    <div class="card-header bg-primary text-white">
                                        <h5 class="mb-0">
                                            <i class="fas fa-tools"></i> Required Skills
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="form-group">
                                            <label>Select Skills</label>
                                            <div style="max-height: 300px; overflow-y: auto; border: 1px solid #ced4da; padding: 10px; border-radius: 4px;">
                                                {% for skill in skills %}
                                                <div class="form-check">
                                                    <input class="form-check-input skill-checkbox" type="checkbox" 
                                                           id="skill_{{ skill.id }}" name="required_skills[]" 
                                                           value="{{ skill.id }}" onchange="toggleSkillOptions({{ skill.id }})">
                                                    <label class="form-check-label" for="skill_{{ skill.id }}">
                                                        <small class="text-muted">{{ skill.category or 'General' }}</small><br>
                                                        {{ skill.skill_name }}
                                                    </label>
                                                    
                                                    <div id="skill_options_{{ skill.id }}" style="display: none; margin-left: 20px; margin-top: 5px;">
                                                        <div class="row">
                                                            <div class="col-md-6">
                                                                <select class="form-control form-control-sm" name="importance_{{ skill.id }}">
                                                                    <option value="Required">Required</option>
                                                                    <option value="Preferred">Preferred</option>
                                                                    <option value="Nice to have">Nice to have</option>
                                                                </select>
                                                            </div>
                                                            <div class="col-md-6">
                                                                <input type="number" class="form-control form-control-sm" 
                                                                       name="min_years_{{ skill.id }}" placeholder="Min years" min="0" value="0">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                {% endfor %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card-footer">
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-save"></i> Post Job
                        </button>
                        <a href="{{ url_for('employer_jobs') }}" class="btn btn-secondary">
                            <i class="fas fa-arrow-left"></i> Cancel
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
function toggleExamOptions() {
    const checkbox = document.getElementById('create_exam');
    const options = document.getElementById('exam_options');
    const titleInput = document.getElementById('exam_title');
    const jobTitle = document.getElementById('title').value;
    
    if (checkbox.checked) {
        options.style.display = 'block';
        if (!titleInput.value && jobTitle) {
            titleInput.value = jobTitle + ' - Technical Assessment';
        }
    } else {
        options.style.display = 'none';
    }
}

function toggleSkillOptions(skillId) {
    const checkbox = document.getElementById('skill_' + skillId);
    const options = document.getElementById('skill_options_' + skillId);
    
    if (checkbox.checked) {
        options.style.display = 'block';
    } else {
        options.style.display = 'none';
    }
}

// Auto-update exam title when job title changes
document.getElementById('title').addEventListener('input', function() {
    const examTitle = document.getElementById('exam_title');
    const createExam = document.getElementById('create_exam');
    
    if (createExam.checked && !examTitle.value) {
        examTitle.value = this.value + ' - Technical Assessment';
    }
});
</script>
{% endblock %}
